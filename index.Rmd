---
title: "library(Fauci)"
author: "Your Names Here"
date: "Add a date"
output:
  rmdformats::readthedown:
    thumbnails: false
    highlight: NULL
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align="center")
library(tidyverse)
```

# Something Intriguing

This is a really interesting blog! About what? Read more to find out...

## Header 2

### Header 3

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For example, you can include **Bold** and _Italic_ and `Code` text.  For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

## Including code and plots

Setting up the data:

```{r cars, echo=FALSE}
data <- read.csv("data/new-project-data.csv") %>%
  mutate(edu_strategies = case_when(
    edu_strategies == "56-94" ~ 56,
    TRUE ~ as.numeric(edu_strategies)
  )) %>%
  mutate(std_edu = case_when(
    std_edu == "48-100" ~ 48,
    TRUE ~ as.numeric(std_edu)
  ))

gen_ed_txt <- read_csv("data/education-gen-text.csv") %>%
  rename(State = State_txt)

gen_ed_txt[15,1] <- "Indiana"
gen_ed_txt[25,1] <- "Mississippi"
gen_ed_txt[43,1] <- "Utah"

content_ed_txt <- read_csv("data/education-content-text.csv") %>%
  rename(State = State_txt)

content_ed_txt[22,1] <- "Mississippi"
content_ed_txt[39,1] <- "Utah"

life_ed_txt <- read_csv("data/education-life-text.csv") %>%
  rename(State = State_txt)

# define vectors for choice values and labels
# for selectInput, needs to be named list
x_choices <- as.list(names(data)[2:22])
x_data_names <- c(names(data)[2:22])
x_choice_names <- c("Sex Ed Mandated",
                    "HIV Ed Mandated",
                    "Medically Accurate",
                    "Age Appropriate",
                    "Culturally Appropriate/Unbiased",
                    "Cannot Promote Religion",
                    "Parents Notified",
                    "Parental Consent",
                    "Opt-Out",
                    "Sex Ed Contraception",
                    "Sex Ed Abstinence",
                    "Sex Ed Marriage",
                    "Sex Ed Orientation",
                    "Sex Ed Negative Outcomes",
                    "HIV Ed Condoms",
                    "HIV Ed Abstinence",
                    "Healthy Relationships",
                    "Sexual decision-making and self-discipline",
                    "Refusal skills and personal boundaries",
                    "Consent",
                    "Dating and sexual violence prevention")
names(x_choices) <- x_choice_names
print(x_choices)

y_choices <- as.list(names(data)[31:38])
y_data_names <- c(names(data)[31:38])
y_choice_names <- c("% schools that provide strategies to Sex Ed teachers",
                    "% of schools that teach STD transmission",
                    "% of schools that teach human sexuality",
                    "% of schools that teach HIV prevention",
                    "% of schools that teach STD prevention",
                    "% students that have had four or more partners",
                    "% students intoxicated during last sexual intercourse")
names(y_choices) <- y_choice_names
```


```{r pretty, echo=FALSE, warning=FALSE, message=FALSE}


         selectInput(inputId = "y"
                        , label = "Choose a practice or behavior:"
                        , choices = y_choices
                        , selected = "Education Strategies")
         
          selectInput(inputId = "x"
                        , label = "Choose an education mandate to color by:"
                        , choices = x_choices
                        , selected = "Sex_Mandated")
            
                          
renderPlotly({
    ggplot(data, aes(x = reorder(State, get(input$y)), y = get(input$y), fill = factor(get(paste(input$x))))) +
      geom_bar(stat = "identity") +
      labs(y = y_choice_names[y_choices == input$y],
           title = paste(paste(names(y_choices)[y_choices == input$y]), "by State")) +
      theme(axis.title.x=element_blank(), axis.text.x=element_blank(),
            axis.ticks.x=element_blank()) #+
    #scale_fill_distiller(palette = "Set2", name = paste(paste(names(x_choices)[x_choices == input$x])))
  })     
```


```{r figure1, echo=FALSE}
use_data <- reactive({
    data <- data %>%
      select(State, input$x, input$y)  %>%
      left_join(gen_ed_txt, by = "State") %>%
      left_join(content_ed_txt, by = "State") %>%
      left_join(life_ed_txt, by = "State")
  })
  
  
  #Hist Tab  -------
  output$bar <- renderPlotly({
    ggplot(use_data(), aes(x = reorder(State, get(input$y)), y = get(input$y), fill = factor(get(paste(input$x))))) +
      geom_bar(stat = "identity") +
      labs(y = y_choice_names[y_choices == input$y],
           title = paste(paste(names(y_choices)[y_choices == input$y]), "by State")) +
      theme(axis.title.x=element_blank(), axis.text.x=element_blank(),
            axis.ticks.x=element_blank()) #+
    #scale_fill_distiller(palette = "Set2", name = paste(paste(names(x_choices)[x_choices == input$x])))
  })
}
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


## Including links and images

You can include [Links](https://www.datadreaming.org/post/r-markdown-theme-gallery/) and images ![team logo](https://raw.githubusercontent.com/stat231-f20/Blog-library-Fauci/main/images/library-fauci3.png)


# You can even create tabs if you want! {.tabset .tabset-fade .tabset-pills}

## Bulleted list

You can make a bulleted list like this:

- item 1
- item 2
- item 3


## Numbered list

You can make a numbered list like this

1. First thing I want to say
2. Second thing I want to say
3. Third thing I want to say

